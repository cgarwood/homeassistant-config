homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # C for Celsius, F for Fahrenheit
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: America/Indiana/Indianapolis
  
  elevation: 196
  latitude: !secret latitude
  longitude: !secret longitude


  customize: !include customize.yaml

# Allows you to issue voice commands from the frontend
conversation:

# Checks for available updates
updater:
  reporting: False

recorder:
  db_url: !secret mysql_server

# Enables support for tracking state changes over time.
history:
  exclude:
    domains:
      - automation
      - updater
    entities:
      - sensor.aeotec_multisensor_6_ultraviolet_10_27
      - sensor.aeotec_multisensor_6_sourcenodeid_10_2
      - sensor.aeotec_multisensor_6_burglar_10_10
      - sensor.aeotec_multisensor_6_alarm_type_10_0
      - sensor.aeotec_multisensor_6_alarm_level_10_1
      - sensor.last_boot
      - sensor.cpu_use
      - sensor.memory_use
      - sensor.back_door_battery
      - sensor.front_door_battery
      - sensor.hallway_smoke_battery
      
# Enables the frontend
frontend:

# Discover some devices automatically
discovery:

# Track the sun
sun:

# View all events in a logbook
logbook:

http:
  api_password: !secret http_password
  trusted_networks:
    - 192.168.1.0/24
  cors_allowed_origins:
    - 'null'
    - '*'
    - 'http://192.168.1.220'
    - !secret cors_address
 
nest:
  username: !secret nest_username
  password: !secret nest_password

zwave:
  usb_path: /dev/zwave
  config_path: /srv/hass/src/open-zwave-control-panel/config

sensor:
  - platform: systemmonitor
    resources:
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot

  - platform: nest
    monitored_conditions:
      - 'weather_temperature'
      - 'weather_humidity'
      - 'weather_condition'

  - platform: template
    sensors:
      front_door_battery:
        value_template: '{{ states.binary_sensor.front_door_sensor_3_0.attributes.battery_level }}'
        unit_of_measurement: '%'
        entity_id: binary_sensor.front_door_sensor_3_0
      back_door_battery:
        value_template: '{{ states.binary_sensor.back_door_sensor_4_0.attributes.battery_level }}'
        unit_of_measurement: '%'
        entity_id: binary_sensor.back_door_sensor_4_0
      hallway_smoke_battery:
        value_template: '{{ states.sensor.hallway_detector_alarm_type_6_0.attributes.battery_level }}'
        unit_of_measurement: '%'


      nest_indoor_temperature:
        value_template: '{{ states.climate.hallway.attributes.current_temperature }}'
      nest_indoor_humidity:
        value_template: '{{ states.climate.hallway.attributes.humidity }}'


climate:
  platform: nest

wink:
  access_token: !secret wink_token

device_tracker:
  platform: unifi
  username: !secret unifi_username
  password: !secret unifi_password
  track_new_devices: false

media_player:
  - platform: firetv
  - platform: cast
  
notify:
  - platform: pushbullet
    api_key: !secret pb_api_key
    channel_name: !secret pb_channel
  
  - platform: nfandroidtv
    name: firetv
    host: 192.168.1.231


group:
  door_sensor_batteries: 
    name: Door Sensor Batteries
    entities:
      - sensor.front_door_battery
      - sensor.back_door_battery
  smoke_detector_batteries: 
    name: Smoke Detector Batteries
    entities:
      - sensor.hallway_smoke_battery
  system_monitor:
    name: System Monitor
    entities:
      - sensor.ram_use
      - sensor.cpu_use
      - sensor.last_boot
  doors: binary_sensor.front_door_sensor_3_0, binary_sensor.back_door_sensor_4_0
  weather: sensor.hallway_temperature, sensor.hallway_humidity, sensor.hallway_condition, sensor.hallway_direction, sensor.hallway_kph
  family: device_tracker.charlessiphone, device_tracker.tinasiphone
  indoor_lights: light.entryway, light.hallway, light.living_room, light.guest_bathroom_fan_light_level_9_0, light.guest_bathroom_vanity_light_level_7_0
  outdoor_lights: light.back_porch, light.front_porch

  multisensor: binary_sensor.aeotec_multisensor_6_sensor_10_0, sensor.aeotec_multisensor_6_temperature_10_1, sensor.aeotec_multisensor_6_relative_humidity_10_5, sensor.aeotec_multisensor_6_luminance_10_3

  default_view:
    view: yes
    entities:
      - group.doors
      - group.weather
      - group.all_lights
      - group.multisensor
      - climate.hallway
      - media_player.living_room
      - media_player.amazon_fire_tv
      - sun.sun
      - device_tracker.charlessiphone
      - device_tracker.tinasiphone
      - script.goodbyelights

  maintenance:
    name: Maintenance
    view: yes
    entities:
      - group.door_sensor_batteries
      - group.smoke_detector_batteries
      - group.system_monitor
      - group.all_automations

automation 1:
  alias: Smoke/CO Alarm
  trigger:
    - platform: numeric_state
      entity_id: sensor.hallway_detector_alarm_type_6_0
      below: 12
  condition:
    - condition: numeric_state
      entity_id: sensor.hallway_detector_alarm_type_6_0
      above: 1
  action:
    - service: homeassistant.turn_on
      entity_id: 
        - light.hallway
        - light.living_room
        - light.front_porch
        - light.back_porch
        - light.guest_bathroom_fan_light_level_9_0
      data:
        brightness: 255
    - service: homeassistant.turn_off
      entity_id:
        - switch.guest_bathroom_fan_switch_8_0
    - service: notify.notify
      data:
        title: "Hallway Smoke/CO Detector"
        message: |
          Hallway Smoke Detector Activated
          Type: {%if is_state('sensor.hallway_detector_alarm_type_6_0', '1') %}Smoke{% elif is_state('sensor.hallway_detector_alarm_type_6_0', '2') %}Carbon Monoxide{% elif is_state('sensor.hallway_detector_alarm_type_6_0', '12') %}Test{% else %}Unknown ({{ states('sensor.hallway_detector_alarm_type_6_0') }}){% endif %}

automation 2:
  alias: Porch Light Arrival
  trigger:
    platform: state
    entity_id: group.family
    from: 'not_home'
    to: 'home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunset
  action:
    service: homeassistant.turn_on
    entity_id: light.front_porch

automation 3:
  alias: Guest Bathroom Auto Lights (Day)
  initial_state: false
  trigger:
    platform: state
    entity_id: binary_sensor.aeotec_multisensor_6_sensor_10_0
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: time
        before: '23:00:00'
        after: '5:00:00'
      - condition: state
        entity_id: light.guest_bathroom_vanity_light_level_7_0
        state: 'off'
  action:
    - service: homeassistant.turn_on
      entity_id: light.guest_bathroom_fan_light_level_9_0
    - service: script.turn_off
      entity_id: script.guest_bathroom_light_day
    - service: homeassistant.turn_on
      entity_id: script.guest_bathroom_light_day

automation 4:
  alias: Guest Bathroom Auto Lights (Night)
  initial_state: false
  trigger:
    platform: state
    entity_id: binary_sensor.aeotec_multisensor_6_sensor_10_0
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: time
        after: '23:00:00'
        before: '5:00:00'
      - condition: state
        entity_id: light.guest_bathroom_fan_light_level_9_0
        state: 'off'
      - condition: state
        entity_id: light.guest_bathroom_vanity_light_level_7_0
        state: 'off'
  action:
    - service: homeassistant.turn_on
      entity_id: light.guest_bathroom_vanity_light_level_7_0
    - service: script.turn_off
      entity_id: script.guest_bathroom_light_night
    - service: homeassistant.turn_on
      entity_id: script.guest_bathroom_light_night

script: !include_dir_named scripts
