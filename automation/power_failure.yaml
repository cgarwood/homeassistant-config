- alias: Power Failure Notification
  trigger:
    - platform: state
      entity_id: sensor.ups_status
      to: 'ONBATT'
    - platform: state
      entity_id: sensor.ups_status
      to: 'ONLINE'
#      for:
#        minutes: 2
  action:
    service: notify.pb
    data_template:
        title: >-
          {%- if trigger.to_state.state == 'ONBATT' -%}
          Power Failure
          {%- elif trigger.to_state.state == 'ONLINE' -%}
          Power Restored
          {%- endif -%}
        message: >-
          {%- if trigger.to_state.state == 'ONBATT' -%}
          Power Failure
          {%- elif trigger.to_state.state == 'ONLINE' -%}
          Power Restored
          {%- endif -%}
          {{ ' ' }}
          at {{now().strftime("%Y-%m-%d %l:%M:%S")}}